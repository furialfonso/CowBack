version: '3.4'
services:
  db:
    container_name: ${APPLICATION_NAME}_${SCOPE}_db
    image: mariadb:jammy
    volumes:
      - ${APPLICATION_NAME}_${SCOPE}_vol:/var/lib/mysql
    environment:
      MARIADB_ROOT_PASSWORD: ${DB_ROOT_PASSWORD}
      MARIADB_DATABASE: ${APPLICATION_NAME}_${SCOPE}_db
    ports:
      - ${DB_PORT}:${DB_PORT}
    networks:
      - ${APPLICATION_NAME}_${SCOPE}_network
    restart: always
  api:
    depends_on:
      - db
    container_name: ${APPLICATION_NAME}_${SCOPE}_api
    image: ${REPOSITORY}/${APPLICATION_NAME}_project:${SCOPE}
    environment:
      CONFIG_DIR: /app
      SCOPE: ${SCOPE}
      PORT: ${APP_PORT}
      GIN_MODE: release
    build:
      context: .
      dockerfile: ./Dockerfile
    ports:
      - ${APP_PORT}:${APP_PORT}
    networks:
      - ${APPLICATION_NAME}_${SCOPE}_network
    restart: always
volumes:
  cow_local_vol:
    external: true
  cow_test_vol:
    external: true
  cow_prod_vol:
    external: true
networks:
  cow_local_network:
    external: true
  cow_test_network:
    external: true
  cow_prod_network:
    external: true